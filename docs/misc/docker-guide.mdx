---
sidebar_position: 7
slug: docker-guide
title: Docker å…¥é—¨æŒ‡å—
description: Docker å®¹å™¨åŸºç¡€ã€å¸¸ç”¨å‘½ä»¤ä¸ Dockerfile ç¼–å†™
---

# Docker å…¥é—¨æŒ‡å—

Docker æ˜¯ç°ä»£å¼€å‘å’Œéƒ¨ç½²çš„æ ‡é…å·¥å…·ã€‚æœ¬æ–‡æ€»ç»“ Docker çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨æ“ä½œã€‚

## ğŸ³ æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| **é•œåƒ (Image)** | åªè¯»æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä¸€åˆ‡ |
| **å®¹å™¨ (Container)** | é•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œå¯è¯»å†™ |
| **ä»“åº“ (Registry)** | å­˜å‚¨é•œåƒçš„åœ°æ–¹ï¼Œå¦‚ Docker Hub |
| **Dockerfile** | æ„å»ºé•œåƒçš„è„šæœ¬æ–‡ä»¶ |

```
Dockerfile â†’ Image â†’ Container
   æ„å»º        è¿è¡Œ
```

---

## ğŸ“¦ é•œåƒæ“ä½œ

### æ‹‰å–é•œåƒ

```bash
# ä» Docker Hub æ‹‰å–
docker pull nginx
docker pull node:18-alpine
docker pull mysql:8.0

# æŸ¥çœ‹æœ¬åœ°é•œåƒ
docker images
docker image ls
```

### åˆ é™¤é•œåƒ

```bash
# åˆ é™¤æŒ‡å®šé•œåƒ
docker rmi nginx

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a
```

### æ„å»ºé•œåƒ

```bash
# åœ¨å½“å‰ç›®å½•æ„å»º
docker build -t myapp:1.0 .

# æŒ‡å®š Dockerfile
docker build -f Dockerfile.prod -t myapp:prod .
```

---

## ğŸš€ å®¹å™¨æ“ä½œ

### è¿è¡Œå®¹å™¨

```bash
# åŸºç¡€è¿è¡Œ
docker run nginx

# åå°è¿è¡Œ + ç«¯å£æ˜ å°„
docker run -d -p 8080:80 nginx

# å‘½åå®¹å™¨
docker run -d --name my-nginx -p 8080:80 nginx

# äº¤äº’å¼è¿è¡Œ
docker run -it ubuntu bash

# æŒ‚è½½ç›®å½•
docker run -d -v /host/path:/container/path nginx

# ç¯å¢ƒå˜é‡
docker run -d -e MYSQL_ROOT_PASSWORD=123456 mysql
```

### å¸¸ç”¨å‚æ•°

| å‚æ•° | è¯´æ˜ |
|------|------|
| `-d` | åå°è¿è¡Œ (detached) |
| `-p 8080:80` | ç«¯å£æ˜ å°„ (ä¸»æœº:å®¹å™¨) |
| `-v /a:/b` | ç›®å½•æŒ‚è½½ (ä¸»æœº:å®¹å™¨) |
| `-e KEY=VAL` | ç¯å¢ƒå˜é‡ |
| `--name xxx` | å®¹å™¨å‘½å |
| `--rm` | é€€å‡ºåè‡ªåŠ¨åˆ é™¤ |
| `-it` | äº¤äº’å¼ç»ˆç«¯ |

### ç®¡ç†å®¹å™¨

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# åœæ­¢/å¯åŠ¨/é‡å¯
docker stop my-nginx
docker start my-nginx
docker restart my-nginx

# åˆ é™¤å®¹å™¨
docker rm my-nginx

# å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨
docker rm -f my-nginx

# åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨
docker container prune
```

### è¿›å…¥å®¹å™¨

```bash
# è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨
docker exec -it my-nginx bash

# æ‰§è¡Œå•ä¸ªå‘½ä»¤
docker exec my-nginx cat /etc/nginx/nginx.conf
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs my-nginx

# å®æ—¶è·Ÿè¸ª
docker logs -f my-nginx

# æœ€å 100 è¡Œ
docker logs --tail 100 my-nginx
```

---

## ğŸ“ Dockerfile ç¼–å†™

### åŸºç¡€æ¨¡æ¿

```dockerfile
# åŸºç¡€é•œåƒ
FROM node:18-alpine

# å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨å‘½ä»¤
CMD ["node", "server.js"]
```

### å¸¸ç”¨æŒ‡ä»¤

| æŒ‡ä»¤ | è¯´æ˜ |
|------|------|
| `FROM` | åŸºç¡€é•œåƒ |
| `WORKDIR` | å·¥ä½œç›®å½• |
| `COPY` | å¤åˆ¶æ–‡ä»¶ |
| `ADD` | å¤åˆ¶æ–‡ä»¶ï¼ˆæ”¯æŒ URL å’Œè§£å‹ï¼‰ |
| `RUN` | æ‰§è¡Œå‘½ä»¤ï¼ˆæ„å»ºæ—¶ï¼‰ |
| `CMD` | å¯åŠ¨å‘½ä»¤ï¼ˆè¿è¡Œæ—¶ï¼‰ |
| `ENTRYPOINT` | å…¥å£ç‚¹ |
| `ENV` | ç¯å¢ƒå˜é‡ |
| `EXPOSE` | æš´éœ²ç«¯å£ |
| `VOLUME` | æŒ‚è½½ç‚¹ |
| `ARG` | æ„å»ºå‚æ•° |

### å¤šé˜¶æ®µæ„å»º

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# ç”Ÿäº§é˜¶æ®µ
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### .dockerignore

```
node_modules
npm-debug.log
.git
.gitignore
*.md
.env
.env.*
dist
coverage
```

---

## ğŸ”— Docker Compose

### docker-compose.yml ç¤ºä¾‹

```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgres://db:5432/myapp
    depends_on:
      - db
    volumes:
      - ./logs:/app/logs

  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=myapp
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### Compose å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ Alpine é•œåƒ

```dockerfile
# âœ… æ›´å°çš„é•œåƒ
FROM node:18-alpine

# âŒ å®Œæ•´é•œåƒè¾ƒå¤§
FROM node:18
```

### 2. åˆç†åˆ©ç”¨ç¼“å­˜

```dockerfile
# âœ… å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œå†å¤åˆ¶æºç 
COPY package*.json ./
RUN npm ci
COPY . .

# âŒ æ¯æ¬¡éƒ½é‡æ–°å®‰è£…ä¾èµ–
COPY . .
RUN npm ci
```

### 3. å‡å°‘å±‚æ•°

```dockerfile
# âœ… åˆå¹¶ RUN å‘½ä»¤
RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*

# âŒ å¤šä¸ª RUN å¢åŠ å±‚æ•°
RUN apt-get update
RUN apt-get install -y curl
```

### 4. é root ç”¨æˆ·è¿è¡Œ

```dockerfile
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser
```

---

## ğŸ“š å¸¸ç”¨é•œåƒ

| é•œåƒ | ç”¨é€” |
|------|------|
| `nginx:alpine` | Web æœåŠ¡å™¨ |
| `node:18-alpine` | Node.js è¿è¡Œç¯å¢ƒ |
| `python:3.11-slim` | Python è¿è¡Œç¯å¢ƒ |
| `postgres:15-alpine` | PostgreSQL æ•°æ®åº“ |
| `redis:alpine` | Redis ç¼“å­˜ |
| `mysql:8` | MySQL æ•°æ®åº“ |
| `mongo:6` | MongoDB æ•°æ®åº“ |

---

## ğŸ”— æ¨èèµ„æº

- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Play with Docker](https://labs.play-with-docker.com/) - åœ¨çº¿ç»ƒä¹ 
