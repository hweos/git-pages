---
slug: code-review
title: 代码评审最佳实践
authors: mason
tags: [代码质量, 团队协作, 最佳实践]
---

Code Review 是提升代码质量和团队能力的重要环节。本文分享高效代码评审的方法和技巧。

<!--truncate-->

## 🎯 为什么要 Code Review

| 收益 | 说明 |
|------|------|
| 发现 Bug | 多双眼睛更容易发现问题 |
| 知识分享 | 团队成员相互学习 |
| 代码质量 | 保持代码风格一致 |
| 架构把控 | 防止设计腐化 |
| 团队成长 | 新人快速融入 |

---

## 📝 提交者指南

### 提交前自检

```markdown
- [ ] 代码能正常运行
- [ ] 单元测试通过
- [ ] 没有 console.log / debug 代码
- [ ] 没有硬编码的敏感信息
- [ ] 代码格式化过 (Prettier/ESLint)
- [ ] 提交信息清晰
```

### PR 描述模板

```markdown
## 改动说明
简述这次改动做了什么、为什么要做

## 改动类型
- [ ] 新功能
- [ ] Bug 修复
- [ ] 重构
- [ ] 文档更新

## 相关链接
- Issue: #123
- 设计文档: [链接]

## 测试说明
如何测试这个改动

## 截图 (如果有 UI 改动)
```

### 保持 PR 小而专注

```bash
# ✅ 好的 PR
- 单一职责，只做一件事
- 200-400 行改动
- 容易理解和评审

# ❌ 不好的 PR
- 混合多个功能
- 上千行改动
- 评审者难以理解
```

---

## 👀 评审者指南

### 评审关注点

```markdown
1. **正确性**
   - 逻辑是否正确
   - 边界情况处理
   - 错误处理

2. **可读性**
   - 命名是否清晰
   - 代码是否易理解
   - 注释是否必要且有用

3. **可维护性**
   - 是否遵循项目规范
   - 是否有重复代码
   - 是否过度设计

4. **性能**
   - 是否有明显性能问题
   - 循环中是否有不必要操作

5. **安全**
   - 是否有安全漏洞
   - 敏感信息处理
```

### 评审评论规范

```markdown
# 使用标签区分优先级

🔴 **必须修改**: 有 bug 或安全问题
> 这里会导致空指针异常，需要添加判空

🟡 **建议修改**: 有更好的写法
> 建议使用 Map 代替对象，性能更好

🔵 **疑问**: 不理解，需要解释
> 这个变量名是什么含义？能否改得更清晰

💚 **赞**: 写得好
> 这个封装很优雅！学到了
```

### 评审反馈技巧

```markdown
# ✅ 好的反馈
"这里使用 useMemo 可以避免重复计算，参考文档：[链接]"

# ❌ 不好的反馈
"这里不对"
"改一下"
```

---

## ⏱️ 评审效率

### 时间管理

```markdown
- 收到 PR 后 24 小时内开始评审
- 每次评审不超过 1 小时
- 大 PR 分多次评审
- 使用番茄工作法集中评审
```

### 自动化辅助

```yaml
# GitHub Actions 自动检查
- ESLint / Prettier
- 单元测试
- 类型检查
- 依赖安全扫描
```

---

## 🔄 评审流程

```
1. 提交者创建 PR
      ↓
2. 自动化检查 (CI)
      ↓
3. 评审者 Review
      ↓
4. 提交者修改 (如需要)
      ↓
5. 评审者 Approve
      ↓
6. 合并代码
```

### GitHub 配置

```yaml
# 分支保护规则
- 需要至少 1 个 Approve
- 需要 CI 通过
- 需要最新代码
- 禁止直接 push
```

---

## 📋 常见问题 Checklist

### JavaScript/TypeScript

```markdown
- [ ] 是否正确处理 null/undefined
- [ ] 异步操作是否有错误处理
- [ ] 是否有内存泄漏风险
- [ ] 是否正确使用 TypeScript 类型
```

### React

```markdown
- [ ] 组件是否过大需要拆分
- [ ] 是否正确使用 Hooks 依赖
- [ ] 是否有不必要的重渲染
- [ ] Key 是否正确设置
```

### API

```markdown
- [ ] 是否验证用户输入
- [ ] 是否有权限检查
- [ ] 错误响应是否规范
- [ ] 是否有性能问题
```

### 安全

```markdown
- [ ] 是否有 XSS 风险
- [ ] 是否有 SQL 注入风险
- [ ] 敏感信息是否加密
- [ ] 是否有硬编码凭证
```

---

## 💬 沟通技巧

### 作为提交者

```markdown
- 主动提供上下文
- 标注需要特别关注的地方
- 及时回复评论
- 感谢评审者的反馈
```

### 作为评审者

```markdown
- 先肯定做得好的地方
- 提供建设性建议
- 区分必须改和建议改
- 给出理由和参考资料
```

### 处理分歧

```markdown
- 基于技术讨论，不针对个人
- 用数据和文档支持观点
- 适时线下讨论
- 必要时请第三方仲裁
```

---

## 📚 推荐资源

- [Google Code Review 指南](https://google.github.io/eng-practices/review/)
- [Conventional Comments](https://conventionalcomments.org/)
- [How to Make Good Code Reviews Better](https://stackoverflow.blog/2019/09/30/how-to-make-good-code-reviews-better/)

---

Code Review 不只是找 bug，更是团队学习和成长的机会。保持开放心态，持续改进。
