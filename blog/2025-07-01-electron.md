---
slug: electron-intro
title: Electron æ¡Œé¢åº”ç”¨å…¥é—¨
authors: mason
tags: [Electron, æ¡Œé¢åº”ç”¨, è·¨å¹³å°]
---

Electron è®©ä½ ç”¨ Web æŠ€æœ¯æ„å»ºè·¨å¹³å°æ¡Œé¢åº”ç”¨ã€‚æœ¬æ–‡ä»‹ç» Electron çš„æ ¸å¿ƒæ¦‚å¿µå’Œå¼€å‘æµç¨‹ã€‚

<!--truncate-->

## ğŸ¯ ä»€ä¹ˆæ˜¯ Electron

```markdown
Electron = Chromium + Node.js + Native APIs

ç‰¹ç‚¹ï¼š
- ä½¿ç”¨ HTML/CSS/JS å¼€å‘
- è·¨å¹³å°ï¼ˆWindows/macOS/Linuxï¼‰
- è®¿é—®åŸç”Ÿ API
- è‡ªåŠ¨æ›´æ–°
```

### çŸ¥ååº”ç”¨

```markdown
- VS Code
- Slack
- Discord
- Notion
- Figma Desktop
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åˆ›å»ºé¡¹ç›®

```bash
mkdir my-electron-app && cd my-electron-app
npm init -y
npm install electron --save-dev
```

### é¡¹ç›®ç»“æ„

```
my-electron-app/
â”œâ”€â”€ package.json
â”œâ”€â”€ main.js          # ä¸»è¿›ç¨‹
â”œâ”€â”€ preload.js       # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ renderer/
â”‚   â”œâ”€â”€ index.html   # é¡µé¢
â”‚   â”œâ”€â”€ style.css
â”‚   â””â”€â”€ renderer.js  # æ¸²æŸ“è¿›ç¨‹
â””â”€â”€ assets/
    â””â”€â”€ icon.png
```

### package.json

```json
{
  "name": "my-electron-app",
  "version": "1.0.0",
  "main": "main.js",
  "scripts": {
    "start": "electron .",
    "build": "electron-builder"
  },
  "devDependencies": {
    "electron": "^28.0.0",
    "electron-builder": "^24.0.0"
  }
}
```

---

## ğŸ”§ ä¸»è¿›ç¨‹

```javascript
// main.js
const { app, BrowserWindow, ipcMain } = require('electron');
const path = require('path');

let mainWindow;

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      contextIsolation: true,
      nodeIntegration: false,
    },
  });

  mainWindow.loadFile('renderer/index.html');

  // å¼€å‘æ—¶æ‰“å¼€ DevTools
  if (process.env.NODE_ENV === 'development') {
    mainWindow.webContents.openDevTools();
  }
}

app.whenReady().then(() => {
  createWindow();

  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) {
      createWindow();
    }
  });
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

// IPC é€šä¿¡
ipcMain.handle('read-file', async (event, filePath) => {
  const fs = require('fs').promises;
  return await fs.readFile(filePath, 'utf-8');
});
```

---

## ğŸŒ‰ é¢„åŠ è½½è„šæœ¬

```javascript
// preload.js
const { contextBridge, ipcRenderer } = require('electron');

// æš´éœ²å®‰å…¨çš„ API ç»™æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electronAPI', {
  // å‘é€æ¶ˆæ¯åˆ°ä¸»è¿›ç¨‹
  sendMessage: (channel, data) => {
    const validChannels = ['save-file', 'open-dialog'];
    if (validChannels.includes(channel)) {
      ipcRenderer.send(channel, data);
    }
  },

  // è°ƒç”¨ä¸»è¿›ç¨‹æ–¹æ³•å¹¶ç­‰å¾…ç»“æœ
  readFile: (filePath) => ipcRenderer.invoke('read-file', filePath),

  // ç›‘å¬ä¸»è¿›ç¨‹æ¶ˆæ¯
  onUpdateAvailable: (callback) => {
    ipcRenderer.on('update-available', (event, ...args) => callback(...args));
  },

  // è·å–å¹³å°ä¿¡æ¯
  platform: process.platform,
});
```

---

## ğŸ–¥ï¸ æ¸²æŸ“è¿›ç¨‹

```html
<!-- renderer/index.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My Electron App</title>
  <link rel="stylesheet" href="style.css">
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self'; script-src 'self'">
</head>
<body>
  <div id="app">
    <h1>Hello Electron!</h1>
    <button id="read-btn">Read File</button>
    <pre id="content"></pre>
  </div>
  <script src="renderer.js"></script>
</body>
</html>
```

```javascript
// renderer/renderer.js
document.getElementById('read-btn').addEventListener('click', async () => {
  try {
    const content = await window.electronAPI.readFile('./package.json');
    document.getElementById('content').textContent = content;
  } catch (error) {
    console.error('Error reading file:', error);
  }
});
```

---

## ğŸ“¡ è¿›ç¨‹é€šä¿¡ (IPC)

### æ¸²æŸ“è¿›ç¨‹ â†’ ä¸»è¿›ç¨‹

```javascript
// æ¸²æŸ“è¿›ç¨‹
window.electronAPI.sendMessage('save-file', { data: 'content' });

// ä¸»è¿›ç¨‹
ipcMain.on('save-file', (event, args) => {
  console.log('Received:', args);
  event.reply('save-complete', { success: true });
});
```

### ä¸»è¿›ç¨‹ â†’ æ¸²æŸ“è¿›ç¨‹

```javascript
// ä¸»è¿›ç¨‹
mainWindow.webContents.send('update-available', { version: '2.0.0' });

// é¢„åŠ è½½è„šæœ¬
contextBridge.exposeInMainWorld('electronAPI', {
  onUpdateAvailable: (callback) => {
    ipcRenderer.on('update-available', (event, data) => callback(data));
  },
});

// æ¸²æŸ“è¿›ç¨‹
window.electronAPI.onUpdateAvailable((data) => {
  console.log('New version:', data.version);
});
```

### åŒå‘é€šä¿¡

```javascript
// ä¸»è¿›ç¨‹
ipcMain.handle('get-user', async (event, userId) => {
  const user = await db.getUser(userId);
  return user;
});

// æ¸²æŸ“è¿›ç¨‹
const user = await window.electronAPI.getUser('123');
```

---

## ğŸ“ åŸç”ŸåŠŸèƒ½

### æ–‡ä»¶å¯¹è¯æ¡†

```javascript
// main.js
const { dialog } = require('electron');

ipcMain.handle('open-file-dialog', async () => {
  const result = await dialog.showOpenDialog(mainWindow, {
    properties: ['openFile'],
    filters: [
      { name: 'Text Files', extensions: ['txt', 'md'] },
      { name: 'All Files', extensions: ['*'] },
    ],
  });
  return result.filePaths;
});

ipcMain.handle('save-file-dialog', async () => {
  const result = await dialog.showSaveDialog(mainWindow, {
    filters: [{ name: 'Text Files', extensions: ['txt'] }],
  });
  return result.filePath;
});
```

### ç³»ç»Ÿèœå•

```javascript
const { Menu } = require('electron');

const template = [
  {
    label: 'File',
    submenu: [
      {
        label: 'Open',
        accelerator: 'CmdOrCtrl+O',
        click: () => openFile(),
      },
      {
        label: 'Save',
        accelerator: 'CmdOrCtrl+S',
        click: () => saveFile(),
      },
      { type: 'separator' },
      { role: 'quit' },
    ],
  },
  {
    label: 'Edit',
    submenu: [
      { role: 'undo' },
      { role: 'redo' },
      { type: 'separator' },
      { role: 'cut' },
      { role: 'copy' },
      { role: 'paste' },
    ],
  },
];

const menu = Menu.buildFromTemplate(template);
Menu.setApplicationMenu(menu);
```

### ç³»ç»Ÿæ‰˜ç›˜

```javascript
const { Tray, Menu } = require('electron');

let tray;

app.whenReady().then(() => {
  tray = new Tray('assets/icon.png');
  
  const contextMenu = Menu.buildFromTemplate([
    { label: 'Show App', click: () => mainWindow.show() },
    { type: 'separator' },
    { label: 'Quit', click: () => app.quit() },
  ]);
  
  tray.setToolTip('My Electron App');
  tray.setContextMenu(contextMenu);
  
  tray.on('click', () => {
    mainWindow.isVisible() ? mainWindow.hide() : mainWindow.show();
  });
});
```

---

## ğŸ“¦ æ‰“åŒ…å‘å¸ƒ

### electron-builder é…ç½®

```json
// package.json
{
  "build": {
    "appId": "com.example.myapp",
    "productName": "My App",
    "directories": {
      "output": "dist"
    },
    "mac": {
      "category": "public.app-category.productivity",
      "target": ["dmg", "zip"]
    },
    "win": {
      "target": ["nsis", "portable"]
    },
    "linux": {
      "target": ["AppImage", "deb"]
    }
  }
}
```

### æ„å»ºå‘½ä»¤

```bash
# æ„å»ºå½“å‰å¹³å°
npm run build

# æ„å»ºç‰¹å®šå¹³å°
npx electron-builder --mac
npx electron-builder --win
npx electron-builder --linux
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

```markdown
1. å»¶è¿ŸåŠ è½½æ¨¡å—
2. å‡å°‘çª—å£æ•°é‡
3. ä½¿ç”¨ Web Workers
4. åˆç†ä½¿ç”¨ IPC
5. æ‰“åŒ…æ—¶æ’é™¤ devDependencies
```

---

## ğŸ“‹ æ¨èå·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| electron-builder | æ‰“åŒ… |
| electron-updater | è‡ªåŠ¨æ›´æ–° |
| electron-store | æŒä¹…åŒ–å­˜å‚¨ |
| electron-log | æ—¥å¿— |

---

Electron è™½ç„¶æœ‰å†…å­˜å ç”¨å¤§çš„ç¼ºç‚¹ï¼Œä½†å¼€å‘æ•ˆç‡å’Œè·¨å¹³å°èƒ½åŠ›æ˜¯å®ƒçš„æ ¸å¿ƒä¼˜åŠ¿ã€‚
